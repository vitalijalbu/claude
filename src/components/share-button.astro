---
import { IconShare } from "../icons";

const { 
  title,
  text = "Guarda questo contenuto interessante!",
  url = Astro.url.href,
  class: className = "",
  variant = "outline"
} = Astro.props;
---

<button class={`btn btn-text share-button ${className}`}
  data-title={title || ''}
  data-text={text}
  data-url={url}
>
  <IconShare />
  <span>Condividi</span>
</button>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const shareButtons = document.querySelectorAll('.share-button');
    
    shareButtons.forEach(button => {
      button.addEventListener('click', async () => {
        const title = button.getAttribute('data-title') || document.title;
        const text = button.getAttribute('data-text');
        const url = button.getAttribute('data-url');
        
        if (navigator.share) {
          try {
            await navigator.share({ title, text, url });
          } catch (error) {
            if (error.name !== 'AbortError') {
              console.error('Errore durante la condivisione:', error);
              fallbackShare(url);
            }
          }
        } else {
          fallbackShare(url);
        }
      });
    });
    
    function fallbackShare(url) {
      navigator.clipboard.writeText(url).then(() => {
        alert('URL copiato negli appunti!');
      }).catch(() => {
        const input = document.createElement('input');
        input.style.position = 'fixed';
        input.style.opacity = '0';
        input.value = url;
        document.body.appendChild(input);
        input.select();
        document.execCommand('copy');
        document.body.removeChild(input);
        alert('URL copiato negli appunti!');
      });
    }
  });
</script>