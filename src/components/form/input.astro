---
const {
  className = '',
  inputClassName = '',
  hasError = false,
  enableStepper = true,
  type = 'text',
  id = `input-${Math.random().toString(36).substring(2, 8)}`,
  ...props
} = Astro.props

const isPassword = type === 'password'
const isSearch = type === 'search'

const baseInputClasses = [
  "input relative block w-full appearance-none rounded-md border px-2.5 py-2 shadow-xs outline-hidden transition sm:text-sm",
  "border-gray-300",
  "text-gray-900",
  "placeholder-gray-400",
  "bg-white",
  "disabled:border-gray-300 disabled:bg-gray-100 disabled:text-gray-400",
  "file:-my-2 file:-ml-2.5 file:cursor-pointer file:rounded-l-[5px] file:rounded-r-none file:border-0 file:px-3 file:py-2 file:outline-hidden focus:outline-hidden disabled:pointer-events-none file:disabled:pointer-events-none",
  "file:border-solid file:border-gray-300 file:bg-gray-50 file:text-gray-500 file:hover:bg-gray-100",
  "file:[border-inline-end-width:1px] file:[margin-inline-end:0.75rem]",
  "file:disabled:bg-gray-100 file:disabled:text-gray-500",
  "[&::-webkit-search-cancel-button]:hidden [&::-webkit-search-decoration]:hidden",
  hasError ? "aria-invalid:ring-2 aria-invalid:ring-red-200 aria-invalid:border-red-500" : "",
  !enableStepper ? "[appearance:textfield] [&::-webkit-inner-spin-button]:appearance-none [&::-webkit-outer-spin-button]:appearance-none" : "",
  isSearch ? "pl-8" : "",
  isPassword ? "pr-10" : "",
  inputClassName
].join(" ")
---
<div class={`relative w-full ${className}`} data-tremor-id="tremor-raw" x-data="{ show: false, type: '${type}' }">
  <input
    type={type}
    :type="type === 'password' ? (show ? 'text' : 'password') : type"
    id={id}
    class={baseInputClasses}
    {...props}
  />

  {isSearch && (
    <div class="pointer-events-none absolute bottom-0 left-2 flex h-full items-center justify-center text-gray-400">
      <span class="size-[1.125rem] shrink-0" aria-hidden="true">search</span>
    </div>
  )}

  {isPassword && (
    <div class="absolute bottom-0 right-0 flex h-full items-center justify-center px-3">
      <button
        type="button"
        aria-label="Toggle password visibility"
        class="h-fit w-fit rounded-xs outline-hidden transition-all text-gray-400 hover:text-gray-500"
        @click="show = !show"
      >
        <span class="sr-only">Toggle password visibility</span>
        <template x-if="show">
          <span class="size-5 shrink-0" aria-hidden="true">eye-off</span>
        </template>
        <template x-if="!show">
          <span class="size-5 shrink-0" aria-hidden="true">eye</span>
        </template>
      </button>
    </div>
  )}
</div>