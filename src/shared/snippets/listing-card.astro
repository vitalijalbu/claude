---
import { Button, Badge, User } from '@/components/index';
import { IconCamera, IconHeart, IconMap } from '@/icons/index';
import GalleryCard from './gallery-card.astro';
import { Image } from 'astro:assets';
const { data } = Astro.props;
const titleId = `listing-title-${data?.id}`;
const mediaCount = data?.media?.length ?? 0;
---

<article
  class="group flex w-full flex-col relative"
  aria-labelledby={titleId}
>
	{mediaCount > 0 && <Badge
		variant="default"
		class="absolute left-2 top-2 z-10"
		aria-label={`Contiene ${mediaCount} immagini`}
	>
		<Image src="/images/icons/camera.svg" alt="Tot foto" width={18} height={18} />
		{data?.media?.length}
	</Badge>}

	<Button
		variant="outline"
		size="icon"
		class="absolute right-2 top-2 z-10"
		aria-label="Salva annuncio"
	>
		<Image src="/images/icons/heart.svg" alt="Salva annuncio" width={18} height={18} />
	</Button>

	<div class="h-[380px] md:h-[380px] overflow-hidden border rounded-lg border-outline relative">
		<a
			href={`/annuncio/${data?.slug}`}
			class="relative !h-full !w-full"
			aria-label={`Vai all'annuncio: ${data?.title}`}
		>
			<GalleryCard
				media={data?.media}
				id={data?.id}
				alt={data?.title}
			/>
		</a>
	</div>

	<div class="py-4">
		<a
			href={`/annuncio/${data?.slug}`}
			aria-labelledby={titleId}
			aria-label={`Vai all'annuncio: ${data?.title}`}
		>
			<div id={titleId} class="font-medium line-clamp-2">{data?.title}</div>
		</a>

		<div class="mt-2 flex items-center text-xs text-muted-foreground">
			<IconMap class="mr-1 h-3.5 w-3.5" aria-hidden="true" focusable="false" />
			<span>{data?.city?.name}</span>
		</div>

		<div class="mt-3">
			<User
				withRating={true}
				withUrl={true}
				data={data?.profile}
				size="sm"
			/>
		</div>
	</div>
</article>
