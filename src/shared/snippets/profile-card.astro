---
import { Picture } from "astro:assets";
const { data, size = 'md', withRating = false, className = '' } = Astro.props;

// Use the first image if available, otherwise fallback to placeholder
const profileImage = data?.images?.length > 0 ? data.images[0] : "/images/placeholder.svg";
const profileName = data?.name || 'Profilo utente';
const profilePhone = data?.phone_number;
const listingsCount = data?.listings_count || 0;

// Size classes
const avatarSize = size === 'sm' ? 'w-8 h-8' : 'w-12 h-12';
const textSize = size === 'sm' ? 'text-base' : 'text-lg';
const iconSize = size === 'sm' ? 16 : 18;
---

<a
  href={`/profilo/${data?.id}`}
  class={`user-link flex items-center justify-between ${size === 'sm' ? 'text-base' : ''} ${className}`}
  aria-label={`Vai al profilo di ${profileName}`}
>
  <div class={`flex gap-2 items-center ${size === 'sm' ? 'text-base' : ''}`}>
    <!-- Avatar -->
    <div class={`${avatarSize} rounded-full overflow-hidden flex-shrink-0`} role="img">
      <Picture
        width={size === 'sm' ? 32 : 48}
        height={size === 'sm' ? 32 : 48}
        src={profileImage}
        class="object-cover w-full h-full"
        alt={`Avatar di ${profileName}`}
        loading="lazy"
        decoding="async"
      />
    </div>
    
    <!-- Name -->
    <span class={size === 'sm' ? 'text-base' : 'text-lg'}>
      {profileName}
    </span>
  </div>

  <!-- Right side info -->
  <div class="flex flex-col items-end gap-1 text-gray-600">
    {listingsCount > 0 && (
      <span class="text-xs">
        {listingsCount} {listingsCount === 1 ? 'annuncio' : 'annunci'}
      </span>
    )}
    
    {withRating && data?.rating > 0 && (
      <span
        class={`flex gap-1 items-center ${size === 'sm' ? 'text-base' : ''}`}
        aria-label={`Valutazione utente: ${data.rating} stelle`}
        title={`Valutazione: ${data.rating} stelle`}
      >
        <svg 
          width={iconSize} 
          height={iconSize} 
          viewBox="0 0 24 24" 
          fill="#FFBF00" 
          aria-hidden="true"
        >
          <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
        </svg>
        {data.rating}
      </span>
    )}
  </div>
</a>