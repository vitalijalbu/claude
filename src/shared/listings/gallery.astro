---
import { Picture } from 'astro:assets';
import { IconX } from '@/icons/index';
import Carousel from '../carousel.astro';
import { MEDIA_URL } from '@/utils/constants';

const { images: rawMedia, alt = '' } = Astro.props;
const images = Array.isArray(rawMedia) ? rawMedia : [];
---

{images.length > 0 && (
	<div x-data="{modalIsOpen: false}">
		<div class="relative w-full">
			<!-- Main Gallery -->
			<div class="swiper gallery-images w-full aspect-video md:aspect-[1/1] rounded-xl overflow-hidden">
				<div class="swiper-wrapper">
					{images.map((image) => (
						<div class="swiper-slide">
							<Picture
								width={1920}
								height={1080}
								class="w-full h-full object-cover"
								src={`${MEDIA_URL}${image.url}`}
								alt={alt}
							/>
						</div>
					))}
				</div>

				<div class="swiper-button-prev"></div>
				<div class="swiper-button-next"></div>
			</div>

			<div class="swiper gallery-thumbs mt-4 px-1 w-full max-w-full overflow-hidden">
				<div class="swiper-wrapper">
					{images.map((image) => (
						<div class="swiper-slide w-[150px] h-[150px] rounded-md overflow-hidden border border-gray-200" key={`thumb-${image.url}`}>
							<Picture
								width={150}
								height={150}
								class="w-full h-full max-h-[150px] object-cover"
								src={`${MEDIA_URL}${image.url}`}
								alt="Thumbnail"
							/>
						</div>
					))}
				</div>
			</div>
		</div>

		<!-- Modal -->
		<div
			x-cloak
			x-show="modalIsOpen"
			x-transition.opacity.duration.100ms
			x-trap.inert.noscroll="modalIsOpen"
			x-on:keydown.esc.window="modalIsOpen = false"
			x-on:click.self="modalIsOpen = false"
			class="fixed inset-0 z-50 flex items-center justify-center bg-black/90 backdrop-blur-md"
			role="dialog"
			aria-modal="true"
			aria-labelledby="defaultModalTitle">
			<div
				x-show="modalIsOpen"
				x-transition:enter="transition ease-out duration-100 delay-100 motion-reduce:transition-opacity"
				x-transition:enter-start="opacity-0 scale-90"
				x-transition:enter-end="opacity-100 scale-100"
				class="relative w-full h-full flex flex-col bg-transparent text-on-surface">
				<!-- Close Button -->
				<div class="absolute top-4 right-4 z-10">
					<button class="btn btn-primary"
						type="button"
						size="icon"
						variant="outline"
						x-on:click="modalIsOpen = false"
						aria-label="Close gallery">
						<IconX />
					</button>
				</div>

				<!-- Carousel in Modal -->
				<div class="flex-1 flex items-center justify-center px-4 py-8">
					<div class="container">
						<Carousel
							class="w-full"
							images={images}
							alt={alt}
						/>
					</div>
				</div>
			</div>
		</div>
	</div>
)}
